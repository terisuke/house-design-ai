# 土地図からの建物形状・間取り自動生成プロセス

## 概要
このドキュメントでは、土地図から建物の形状と間取りを自動生成するプロセスについて説明します。このプロセスは、CAD図面生成の前段階として重要な役割を果たします。

## プロセスフロー

### 1. 土地図のアップロードと前処理
- [x] Google Forms経由での土地図アップロード
- [x] Google Driveへの自動保存
- [x] Cloud Storageへの同期
- [x] 画像の前処理（リサイズ、正規化）

### 2. AIによる土地・道路分析
- [x] YOLOv11による建物・道路セグメンテーション
  - 建物領域の検出
  - 道路領域の検出
  - セグメンテーションマスクの生成
- [x] セグメンテーション結果の後処理
  - ノイズ除去
  - 境界線の平滑化
  - 建物外形の抽出

### 3. 建物形状の決定
- [x] セグメンテーション結果からの建物外形生成
  - 境界線のベクトル化
  - 角の検出と補正
  - 直線・曲線の識別
- [x] 建築法規制の考慮
  - 建蔽率の計算
  - 容積率の計算
  - 道路斜線制限の適用
- [ ] 建物形状の最適化
  - 面積最大化
  - 形状の単純化
  - 実用性の考慮

### 4. 間取りの生成
- [x] 建物外形に基づく間取り生成
  - 部屋の配置
  - 動線の確保
  - 採光・通風の考慮
- [x] 基本的な間取りルールの適用
  - 居室の最小面積
  - 廊下の幅
  - 階段の寸法
- [ ] 間取りの最適化
  - 動線の効率化
  - プライバシーの確保
  - 機能性の向上

### 5. CAD図面生成の準備
- [x] 間取りデータのCAD形式への変換
  - 壁の位置と厚さ
  - 開口部の位置と寸法
  - 部屋ラベルの配置
- [x] FreeCAD用データの準備
  - 座標系の変換
  - レイヤー構造の定義
  - 図面要素の分類

## 技術スタック

### 画像処理・AI
- [x] YOLOv11
  - セグメンテーションモデル
  - 物体検出モデル
- [ ] YOLOv12（将来計画）
  - アテンション機能の活用
  - 間取り画像認識機能の追加
  - 精度向上と処理速度の改善
- [x] OpenCV
  - 画像前処理
  - 輪郭検出
  - 形状分析
- [x] NumPy
  - 数値計算
  - 配列操作
  - 行列演算

### データ管理
- [x] Google Drive API
  - ファイル管理
  - アクセス制御
- [x] Cloud Storage
  - データ保存
  - バックアップ
- [x] Google Forms
  - データ収集
  - メタデータ管理

### クラウドインフラ
- [x] Google Cloud Platform
  - Cloud Run
  - Vertex AI
  - Cloud Storage
- [x] Docker
  - コンテナ化
  - 環境の統一
- [x] CI/CD
  - 自動デプロイ
  - テスト自動化

## 実装状況

### 完了した機能
1. [x] 土地図のアップロードと前処理
   - Google Forms/Drive連携
   - 画像の前処理パイプライン
   - Cloud Storage同期

2. [x] AIによる土地・道路分析
   - YOLOv11モデルの実装
   - セグメンテーション処理
   - 結果の後処理

3. [x] 基本的な建物形状生成
   - セグメンテーションからの外形抽出
   - 基本的な法規制チェック
   - 形状のベクトル化

4. [x] 基本的な間取り生成
   - 部屋配置アルゴリズム
   - 基本的な間取りルール
   - CADデータ変換

### 進行中の機能
1. [ ] 建物形状の最適化
   - 面積最大化アルゴリズム
   - 形状の単純化処理
   - 実用性評価

2. [ ] 間取りの最適化
   - 動線最適化
   - プライバシー考慮
   - 機能性向上

3. [ ] 法規制チェックの強化
   - 詳細な建蔽率計算
   - 容積率の正確な計算
   - 斜線制限の厳密な適用

## 今後の課題

### 技術的課題
1. [ ] 建物形状の最適化アルゴリズムの改善
   - より実用的な形状生成
   - 建築法規制との整合性
   - 処理速度の向上

2. [ ] 間取り生成の高度化
   - より自然な部屋配置
   - 多様な間取りパターン
   - ユーザー要件の反映

3. [ ] 法規制チェックの自動化
   - 地域ごとの規制対応
   - 複雑な斜線制限の処理
   - エラー検出の精度向上

4. [ ] YOLOv12への移行計画
   - アテンション機能の活用方法検討
   - 間取り画像認識機能の実装
   - モデルトレーニングデータの準備

### 運用上の課題
1. [ ] 処理時間の最適化
   - バッチ処理の効率化
   - 並列処理の活用
   - キャッシュ戦略の改善

2. [ ] エラーハンドリングの強化
   - エラー検出の精度向上
   - リカバリー処理の改善
   - ユーザーへのフィードバック

3. [ ] データ品質の向上
   - 入力データの検証
   - 結果の品質評価
   - フィードバックループの確立

## 次のステップ

### 短期目標（1-2週間）
1. [ ] 建物形状最適化アルゴリズムの実装
   - 基本的な面積最大化
   - 形状の単純化
   - 法規制チェックの統合

2. [ ] 間取り生成の改善
   - 動線最適化の実装
   - プライバシー考慮の追加
   - 機能性評価の導入

3. [ ] 法規制チェックの強化
   - 建蔽率計算の精度向上
   - 容積率計算の実装
   - 斜線制限の詳細対応

### 中期目標（1-2ヶ月）
1. [ ] システムの安定化
   - エラーハンドリングの強化
   - パフォーマンスの最適化
   - テストカバレッジの向上

2. [ ] ユーザビリティの向上
   - インターフェースの改善
   - フィードバック機能の強化
   - ドキュメントの整備

3. [ ] 新機能の追加
   - 多様な間取りパターン
   - カスタマイズオプション
   - バッチ処理機能

4. [ ] YOLOv12への移行準備
   - アテンション機能の調査
   - 間取り画像認識のためのデータセット準備
   - 移行計画の詳細化

## まとめ
現在、土地図からの建物形状・間取り自動生成の基本機能は実装済みです。YOLOv11によるセグメンテーション、基本的な建物形状生成、間取り生成の機能が動作しています。次のステップでは、建物形状の最適化、間取り生成の改善、法規制チェックの強化に焦点を当てて開発を進めていきます。また、将来的にはYOLOv12への移行を計画しており、アテンション機能を活用した間取り画像認識機能の追加を検討しています。