# 土地図からの一軒家CAD図自動生成システム 実装計画書
## 最終更新日: 2025年4月28日

## 1. 実装の全体ゴール
土地図をアップロードするだけで、自動的に一軒家のCAD図が生成されるシステムを構築する。FreeCADを組み込み、YOLOv11ベースの建物・道路セグメンテーションシステムを拡張する。

## 2. 実装状況（2025-04-28更新）

### 2.1 完了した実装
- ✅ FreeCADのDockerコンテナ化
- ✅ FastAPIベースのFreeCAD APIサービス
- ✅ グリッドデータ処理エンドポイント
- ✅ 2D図面変換エンドポイント
- ✅ 基本的な壁・開口部の描画機能
- ✅ 寸法線生成機能
- ✅ Cloud RunへのFreeCAD APIデプロイ
- ✅ Cloud StorageでのFCStdモデル保存
- ✅ PyTorchとStreamlitの互換性問題の解決
- ✅ モニタリング設定（エラー率、レイテンシー、メモリ使用量）

### 2.2 進行中の実装
- 🟡 FreeCADの実際の処理実装
- 🟡 建築基準法チェック機能
- 🟡 建具記号ライブラリ
- 🟡 タイトルブロックテンプレート
- 🟡 StreamlitのGCPクラウドデプロイ
- 🟡 Vertex AI統合の実装
- 🟡 セグメンテーション精度の向上

## 3. 優先実装項目
1. FreeCAD APIの完全実装
2. StreamlitアプリケーションのCloud Runデプロイ
3. 建築基準法チェック機能
4. Vertex AI統合の実装
5. YOLOv12への移行準備

## 4. 主要コンポーネント

### 4.1 土地分析エンジン
- YOLOv11による建物・道路セグメンテーション
- セットバック計算と建築可能エリア特定
- グリッド生成と間取り配置アルゴリズム

### 4.2 FreeCAD統合インターフェース
- FastAPIベースのREST API
- グリッドデータからのCADモデル生成
- 2D図面と3Dモデルの出力

### 4.3 建築図面生成
- 壁・開口部・建具の自動配置
- 寸法線と注釈の生成
- 建築基準法チェック機能

### 4.4 クラウドインフラ
- GCP Cloud Runによるスケーラブルなデプロイ
- Cloud Storageによるモデル保存
- Vertex AIによる推論最適化

## 5. 実装ステップ

### 5.1 土地分析エンジン
1. YOLOv11モデルの最適化
2. セットバック計算アルゴリズムの改善
3. グリッド生成の柔軟性向上
4. 間取り配置アルゴリズムの拡張

### 5.2 FreeCAD統合インターフェース
1. APIエンドポイントの完全実装
2. エラーハンドリングの強化
3. パフォーマンス最適化
4. ドキュメント作成

### 5.3 建築図面生成
1. 壁・開口部描画機能の拡張
2. 建具ライブラリの実装
3. 寸法線生成の自動化
4. 建築基準法チェック機能の実装

### 5.4 クラウドインフラ
1. Cloud Runサービスの最適化
2. ストレージ管理の改善
3. Vertex AI統合の実装
4. モニタリングとアラートの設定

## 6. 技術的課題

### 6.1 FreeCADの安定性
- Dockerコンテナ内でのFreeCAD実行の安定化
- メモリリーク対策
- タイムアウト処理の実装

### 6.2 セグメンテーション精度
- YOLOv12への移行計画
- データセット拡充
- モデル最適化

### 6.3 パフォーマンス
- 処理時間の短縮
- リソース使用量の最適化
- 並列処理の実装

### 6.4 スケーラビリティ
- 負荷分散の実装
- オートスケーリングの設定
- コスト最適化

## 7. 次のステップ
1. FreeCAD APIの完全実装を完了させる
2. StreamlitアプリケーションをCloud Runにデプロイする
3. 建築基準法チェック機能の実装を開始する
4. Vertex AI統合の実装を進める
5. YOLOv12への移行準備を開始する
