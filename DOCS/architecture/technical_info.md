# 二階建て住宅の自動間取り生成: Diffusionモデル・GNN・LLMを活用した最新アプローチ

## 導入

建築設計において、間取り（フロアプラン）の自動生成は近年大きな進歩を遂げています。専門知識なしに理想の間取りを得たい一般ユーザや、設計の初期案出しを効率化したい建築家にとって、自動間取り生成システムは有用なツールとなり得ます。特に日本の二階建て一軒家では、限られた敷地で効率的な空間配置を求められるため、AIによる自動提案への期待が高まっています。

この分野では2010年代より遺伝的アルゴリズムなど探索手法や、畳み込みニューラルネットワークを用いた生成モデルなど様々な試みが行われてきました。しかし従来の手法では、入力条件（部屋のつながりや要望）に合わない配置が出力されたり、バリエーションが乏しかったり、あるいは出力されたプランが実用的でないケースも指摘されています。近年登場したHouseDiffusionは、この課題に対し拡散モデル（Diffusionモデル）を導入し、バブル図（部屋の接続関係を示すグラフ）を入力すると直接ベクター形式の間取りを生成する革新的アプローチを提案しました。拡散モデルにより部屋の角の座標群をノイズから徐々に精細化することで、入力グラフ制約に適合しつつ多様で現実的なプランを得ることができます。この手法は従来手法を大きく上回る精度評価（全ての指標で有意な改善）を達成し、直交に限定されない自由なプラン形状（非マンハッタン構造）や部屋ごとの頂点数制御も可能にしています。

本稿では、日本の二階建て住宅を対象とした自動間取り生成システムについて、最新研究に基づくアプローチを整理します。Diffusionモデルによるベクター間取り生成、グラフニューラルネットワーク (GNN) によるレイアウト最適化、**大規模言語モデル (LLM)＋拡散モデルによる構成支援、そして探索アルゴリズム（遺伝的アルゴリズムやルールベース）**とのハイブリッド手法について、それぞれの特徴と利点を概説します。さらに現状のベストプラクティスや複数手法を組み合わせたパイプライン案を比較検討し、最後に実務・商用展開に向けた提言をまとめます。

## 提案ロジック（最新研究に基づくアプローチ）

### Diffusionモデルを用いたベクター間取り生成

拡散モデル (Diffusion Model) は近年画像生成などで注目される生成モデルで、ノイズから徐々にデータを精緻化していくプロセスで多様なサンプルを得られる点が特徴です。間取り生成への応用としては、先述の HouseDiffusionが代表例です。HouseDiffusionでは間取りを部屋ごとのポリゴンループ（ベクター形式）で表現し、まず部屋やドアの頂点座標をランダムなノイズから初期化、拡散モデルによる逐次デノイジングでこれを洗練させていきます。モデル内部ではTransformer型ネットワークを用い、入力のバブル図（部屋グラフ）に基づき部屋配置を制約する注意機構を組み込んでいます。その結果、出力間取りは入力どおりの部屋接続関係を保ちながら、現実的な配置・形状となります。従来の画像（ラスタ）ベース手法では生成後のベクター化処理が必要でしたが、本手法は直接ベクター間取りを得られるため後処理が軽減され、グローバルな整合性も高く評価されています。実際、定量評価でも既存モデルを大きく上回る性能を示しました。

また最新の研究では、拡散モデルを複数の条件で制御する試みもあります。例えばZengら(2024)の FloorplanDiffusion は、バブル図に加えて建物外形や部屋数などマルチ条件を入力できる二段階の生成モデルで、柔軟な条件指定と高品質な間取り生成を両立しています。このようにDiffusionモデルは、入力条件に対し高い適応性と多様性を持つ間取り自動生成の新たな基盤技術として注目されています。

### GNNによるグラフ最適化アプローチ

間取りをグラフ構造として扱い最適化するアプローチも有力です。ここで言うグラフとは、部屋をノード、部屋同士の接続や境界をエッジで表したもの（いわゆるバブル図）です。グラフニューラルネットワーク (GNN) を用いることで、この部屋グラフから具体的なレイアウト（各部屋の位置と形状）を推定できます。代表的な研究の一つ Graph2Planでは、レイアウトグラフと建物外形を入力とし、まずGNNで各部屋の大まかな配置（バウンディングボックス）を予測、次いでそれらを組み合わせた詳細な間取り画像を生成・微調整する二段階プロセスを採用しました。Graph2Planは大規模データセットRPLAN（約8万件の間取り）で学習しており、与えられた部屋数や外形寸法の制約を満たすレイアウトを自動生成できる点が特徴です。

しかし、部屋一つをグラフの単一ノードで表現する従来の方法では、細かな相互作用（例えば部屋の特定の辺だけが隣室と接する関係など）を表現しきれないという課題があります。この問題に対し、最新の研究ではファクターグラフによる高精度化が図られています。具体的には各部屋を複数の潜在ノード（例: 四辺に対応するノード）で表現し、制約条件ごとにファクターノードを設けて部屋間の高次な関係をモデル化します。このファクターグラフ上でメッセージパッシング（情報伝搬）を行うGNNを学習することで、ユーザ要件に忠実なレイアウトを得ることに成功しています。その結果、従来手法に比べIoU（間取りの一致率）で大幅な改善が報告されており、ユーザが逐次レイアウトを調整する対話的プロセスへの適用も視野に入っています。以上のように、GNNベースの手法はグラフ制約を直接扱える強みがあり、事前に部屋関係が定まっている場合には高速かつ高精度なプラン生成が期待できます。

### LLM＋拡散モデルによる構成補助アプローチ

近年、大規模言語モデル（LLM）の登場により、テキストで書かれた要求から直接間取りを生成・編集するアプローチも現れました。LLMは人間のように文章を解釈・生成できるため、ユーザが「4LDKで対面キッチンのある家が欲しい」といった自然言語の要望を与えるだけで、AIがそれを解析し間取り設計に反映できる可能性があります。

2024年末に提案された HouseTune（HouseLLM）は、この方向性の先端的な例です。HouseTuneではまずチェイン・オブ・ソート (CoT) と呼ばれる手法でLLMに段階的な推論をさせ、ユーザ要求から初期レイアウト案（部屋の並びや配置の概略）をテキストベースで生成します。この初期案（Layout-Init）は簡易的なため寸法や形状の正確さに欠けることもありますが、人間にとって理解しやすい大まかなプランとして得られます。次に第二段階として、その初期レイアウトを条件（コンディション）に用いた拡散モデルで詳細な最終間取り (Layout-Final) を生成します。このDiffusionモデルはLayout-Initを下敷きにすることで探索空間を狭め、ユーザ要求に沿いつつ細部まで整合した間取りを出力できます。二段構えのこの手法により、ユーザはただ希望を文章で伝えるだけで高度な自動プランニングが可能となり、かつ従来手法を上回る高精度（全評価指標でのSOTA達成）が報告されています。

さらに対話性に焦点を当てたChatHouseDiffusionというアプローチもあります。ChatHouseDiffusionでは、LLMがユーザの文章プロンプトを解析してJSON形式の部屋要件に変換し（学習時は正確性のためルールベース解析を併用）、それをGraphormerと呼ばれるグラフ構造用TransformerでエンコードしてからDiffusionモデルにより間取りを生成します。この仕組みにより、ユーザはまずテキスト入力でおおまかな要望に沿った間取りを得て、さらに「この部屋をもう少し大きく」など追加指示を出すことで、部分的な調整を再生成せずに行えるインタラクティブな編集が可能です。実験では、ChatHouseDiffusionは他のモデルより高いIoU精度を達成しつつ、細かな部分修正にも耐えうる実用性を示しています。「LLM＋拡散」のアプローチはこのように**ユーザの意図を汲み取るフロントエンド（LLM）と空間デザインを描くバックエンド（拡散モデル）**を組み合わせることで、非専門家にも使いやすく柔軟な間取り自動生成を実現しつつあります。

### 探索アルゴリズム（GA/ルールベース等）とのハイブリッド

完全なデータ駆動の学習モデルだけでなく、古典的な探索アルゴリズムやルールベース手法を組み合わせることで、生成プランの実用性を高める試みも考えられます。例えば遺伝的アルゴリズム (GA) は、レイアウト案を遺伝子と見立てて最適解を進化的に探索する手法で、部屋面積の配分や動線の長さなど複数の目的を同時に最適化するのに適しています。GA単独では計算コストが大きく収束に時間を要する問題がありますが、近年の研究ではハイブリッド手法によってその弱点を補う動きがあります。複数のアルゴリズムを組み合わせることで、設計基準や環境データ、エネルギー効率など様々な要件を組み込んだ最適化が可能となり、かつ探索の高速化も報告されています。実際、GA・ヒルクライミング・群知能などを統合した手法では、単一手法では困難だった複雑な制約下でのプラン生成を加速できることが示されています。

ルールベースのアプローチも有用です。建築設計には「階段は上下階で位置を揃える」「浴室は配管の都合上上下階で近接させる」などドメイン知識に基づくルールが多数存在します。これらをハードコンストレイント（必ず満たす制約）として組み込み、生成モデルが出力したプランをチェック・補正することで、現実的で法規にも適合しやすいプランを得ることができます。例えば生成結果を評価してスコア化し、制約違反があればGAによる微調整や修正ルールの適用で合格点まで改善するといったフレームワークも考えられます。ハイブリッド手法の利点は、データ駆動モデルの創造性・柔軟性とルールベース手法の確実性を両取りできる点にあります。適切に組み合わせることで、単独のAIモデルでは難しい細部の調整や品質保証を行いながら、自動生成のメリットを享受できるでしょう。

## 比較

### 実装の速さ・精度：現状のベストプラクティス

現時点（2025年5月）で、実装容易性と精度の両面から見た各アプローチの特徴を整理します。

- **Diffusionモデル単独**: 精度・多様性の面では非常に優秀で、HouseDiffusionが示したように従来比で大幅に制約遵守性・表現力が向上しています。一方で学習コストは高く、数万件規模の間取りデータセットと長時間の学習が必要です。生成においても拡散過程のステップを重ねるため推論速度が遅い傾向があります。しかし最近はDiffusionモデルの高速化手法（例: Latent Diffusionによる低次元空間生成など）も開発が進んでおり、実時間応答も徐々に現実味を帯びています。また既存モデルのファインチューニングによる流用も可能なため、実装そのものはオープンソースプロジェクト等を活用することで比較的迅速に開始できるでしょう。

- **GNN（グラフ最適化）**: 部屋グラフさえ準備できれば、単一のニューラルネットワーク推論で間取り全体を出力できるため高速です。Graph2Planのように画像生成を挟む手法でも、マルチステップのDiffusionに比べれば処理は軽量です。また制約を直接扱える利点から、与えられた部屋関係を厳密に守るレイアウト生成には適しています。ただし出力の多様性や創造性は学習データに依存しやすく、未知のレイアウトパターンを生み出す柔軟性ではDiffusionモデルに一歩譲ります。実装面ではグラフデータの準備や処理が必要ですが、公開実装やライブラリも増えており、比較的取り組みやすいでしょう。精度面では最新のファクターグラフ活用により従来以上に制約適合性が高まっており、適切なモデルを選べば実務レベルの精度も期待できます。

- **LLM＋拡散**: ユーザビリティと精度のバランスが極めて良い最新のパラダイムです。HouseTuneでは専門的なデータセットに全面依存せずとも、LLMがテキストからレイアウトを起案することで学習の難易度を下げる効果もあったと報告されています。精度は現状で最高水準（全指標でSOTA）であり、特にユーザ要望への適合という観点では他に代えがたい強みです。一方でシステム全体の実装難易度は高めです。大規模言語モデルを扱うためのプロンプト設計や、LLMから得たレイアウト案をどう構造化してDiffusionモデルに渡すかといったパイプライン構築が必要になります。またLLM利用にはAPIコストや応答時間の問題も絡みます（ただしオープンソースLLMの発展により自前運用も可能になりつつあります）。推論速度自体は、LLM解析＋Diffusion生成の二段階を踏むものの、どちらも最適化が進んでいるため実用範囲に収まるでしょう。総じて、精度最優先ならLLM＋拡散モデルが有望ですが、構築リソースやデータが限られる場合はGNNのみ、あるいはDiffusionモデルのみから着手し、徐々に統合を図るのが現実的と言えます。

- **ハイブリッド（探索アルゴリズム＋学習モデル）**: 精度向上や制約順守の切り札として位置づけられますが、実装コストや動作速度とのトレードオフがあります。例えば生成後にGAで最適化を行う場合、目的関数の設計や評価の繰り返し計算に時間を要する可能性があります。実装も複雑で、AIモデルとアルゴリズムのインタフェースを綿密に作り込む必要があります。しかし得られるメリットも明確で、ルールベースで絶対に譲れない条件（法規や構造上の制約）を保証しつつ、モデルの提案力を活かしたプランニングが可能です。現状のベストプラクティスとしては、まず学習モデル単独で土台を作り、要所で探索的調整を加えるというハイブリッド手法が考えられます。完全自動で精度100%を目指すより、人が関与する前提で「自動生成90%＋仕上げ10%」のイメージで導入する方が現実的との指摘もあります。したがって、精度と実装効率のバランスはプロジェクトの目標次第ですが、必要に応じ組み合わせる柔軟性を持たせるのが賢明でしょう。

### 複数手法の組み合わせ可能性とパイプライン案

上述の機能を組み合わせることで、各手法の長所を活かし短所を補うパイプライン構築が可能です。ここでは一例として、将来的に有望と思われる統合パイプライン案をステップごとに紹介します。

1. **要件の取得・解析（LLMによるフロントエンド）**: ユーザから希望の間取り条件を自然言語や簡易入力フォームで取得します。例えば「3LDKで2階に主寝室、1階にLDK。浴室は1階。」といった要望を、大規模言語モデル（LLM）によって解析します。LLMはこのテキストから部屋の種類・数、階ごとの配置制約、各部屋の関係などを読み取り、**構造化された出力（例: JSONやグラフ表現）**を生成します。この段階でユーザとの対話を行い、要件のあいまいさを解消することも可能です。

2. **初期レイアウト案の生成（グラフ最適化/GNN or ルールベース）**: LLMが出力した要件に基づき、まずは大まかなレイアウトを作成します。ここではルールベースで定められたひな型に当てはめたり、GNNモデルに部屋グラフ＋建物外形を入力して部屋配置案を出力したりする方法が考えられます。例えばGraph2Planのようなモデルで各階の部屋配置（長方形の位置関係）を予測させるか、あるいは予め用意したテンプレートプランを要件に合うよう最適化アルゴリズムで微調整してもよいでしょう。重要なのはこの段階で大きな破綻のないプランの骨格を用意することです。二階建ての場合は、1階プラン決定→2階プラン生成の順に行い、階段や吹き抜け位置など上下階の連携要素も考慮します（これはルールベースで対応可能です）。

3. **詳細プランの生成（Diffusionモデルによる精緻化）**: 続いて、ステップ2で得た初期レイアウト案を条件入力として、Diffusionモデルによる詳細な間取り図を生成します。具体的には、初期案をベースとしたレイアウト図（あるいは部屋ポリゴンデータ）を拡散モデルのコンディションに用い、壁の厚みやドア・窓の配置、細かな寸法バランスなどを含む完成図を出力させます。拡散モデルは初期案から大きく逸脱しない範囲でランダム性を持たせられるため、細部の異なる複数案を生成してユーザに提示することもできます。ユーザはその中から好みやニーズに合致するプランを選択できます。

4. **制約チェックと最終調整（ハイブリッド仕上げ）**: 生成された詳細プランに対し、予め定めた検証ルールや評価指標で制約違反がないかチェックします。例えば「建ぺい率オーバー」「廊下幅が最低基準未満」「2階トイレの下に居室がある（音の問題）」等の実務上のチェックポイントをルールエンジンで検査します。違反が見つかった場合、該当箇所を修正するために局所的な再生成を行ったり（Diffusionモデルを部分的に条件付け再実行）、あるいはGAで該当部分の形状を微調整して評価スコアが改善する案を探します。こうした自動フィードバックループにより、プランの実用性を高めます。必要に応じてステップ2や3に遡って再生成する仕組みも有効です（例えば「どうしても解決できない配置矛盾がある→初期案段階から見直し」など）。

5. **ユーザ確認と反復**: 最後にユーザに生成プランを提示し、フィードバックを得ます。ユーザが「ここをもう少し広くしたい」「この部屋は不要になった」など要望を追加すれば、システムは再度LLM解析を行い、上記ステップを反復します。ChatHouseDiffusionのように、完全に一からやり直さず部分編集に対応できるとユーザ体験が向上します。最終的にユーザが満足すれば、そのプランをCADデータ化するなどして実施設計フェーズへ引き継ぎます。

上述のパイプラインは少々複雑ですが、それぞれの段階で異なるAI技術の強みを活かせる点がメリットです。LLMで要件を正確に読み取り（ステップ1）、従来知見やデータセットで培ったノウハウをルール/GNNで活用しつつ初期解を出し（ステップ2）、高表現力のDiffusionモデルで細部まで詰め（ステップ3）、最後に人間の知識を凝縮したルールで品質保証する（ステップ4）という流れは、ある意味人間の設計プロセスをトレースしたものとも言えます。実装当初は一部のステップから導入し、徐々に他の要素を追加していくことで、段階的に高度な自動化を実現できるでしょう。

## まとめ：実務・商用展開に向けた提言

日本の二階建て住宅向け自動間取り生成システムを実務に展開するには、いくつか留意すべきポイントがあります。

まず、日本固有の制約やデータへの対応が重要です。間取りの好みや生活様式、建築基準法などの制約は国ごとに異なります。例えば日本家屋では「玄関からトイレが直接見えない配置」や「採光のため2階居室は必ず窓を設ける」等の暗黙のルールがあります。モデル学習には日本の住宅データをできるだけ取り入れ、ルールベースチェックにも国内の建築基準を反映させる必要があります。幸い、近年は不動産サイトの間取りデータや住宅メーカーのプラン集などもデジタル化が進んでおり、データセット整備の見通しは明るいでしょう。社内で過去に手掛けた設計プランがあれば、それらをファインチューニング用データやルール抽出のベースとして活用することも効果的です。

次に、ユーザとの協働を前提にシステム設計することを提言します。自動生成されたプランに対し、ユーザ（施主や建築士）が修正を加えられるインタフェースを用意しましょう。完全自動で提案されたプランであっても、人は細かな好みや直感的な修正点を持つものです。LLM＋拡散モデルやChatGPT系の対話AIを組み込めば、ユーザの指示を対話的に解釈して設計に反映することも容易です。最終的な意思決定は人間が行うという位置付けにすることで、AI提案への心理的ハードルも下がり、実務に受け入れられやすくなります。「AIがプランを考え、人が評価・微調整する」という二人三脚のワークフローを確立することが商用展開への近道となるでしょう。

また、段階的な導入も鍵です。初めはプラン自動生成のサジェスト機能として、例えば「ゾーニング案自動作成」や「水回り配置の自動最適化」といった部分的な機能から提供し、徐々に信頼性を高めながら機能範囲を広げる戦略が考えられます。いきなりフルオートの間取り作成システムを導入するより、部分的なAI支援ツールとして現場に浸透させフィードバックを得ることで、実用上重要な課題（動線の良し悪し評価や、収納量の確保など生成モデルだけでは判断しにくい点）の洗い出しと解決策の追加が可能です。社内共有ツールとして使いながら改良を重ね、十分に実績と信頼を積んだ段階でエンドユーザ向けサービスや商品として展開すれば、安全かつ効果的です。

最後に、これからの展望としてマルチモーダルな最適化への発展が挙げられます。間取り自動生成を軸に、同時に建物の3Dモデルや構造計算、設備計画との連携まで視野に入れる動きです。例えば間取り案ごとに概算工事費や省エネ性能をAIが評価できれば、ユーザは様々な案を比較検討しやすくなるでしょう。そのためにもまずは間取り生成AIを中核に据え、関連する評価AI・最適化アルゴリズムと組み合わせた包括的な住宅設計支援システムを目指すことを提言します。

以上のように、Diffusionモデル・GNN・LLM・探索アルゴリズムを適材適所で組み合わせた自動間取り生成システムは、二階建て住宅の設計プロセスに革新をもたらす可能性があります。最新研究の知見を取り入れつつ、実務の知恵とも融合させたアプローチで、より良い住まいづくりに貢献できることを期待しています。

## 参考文献

1. M. A. Shabani, S. Hosseini, Y. Furukawa, "HouseDiffusion: Vector Floorplan Generation via a Diffusion Model with Discrete and Continuous Denoising," CVPR 2023. https://arxiv.org/abs/2303.13339

2. R. Hu et al., "Graph2Plan: Learning Floorplan Generation from Layout Graphs," ACM TOG, 39(6), 2020. https://dl.acm.org/doi/10.1145/3414685.3417820

3. P. Zeng et al., "Residential floor plans: Multi-conditional automatic generation using diffusion models," Automation in Construction, 152, 2024. https://www.sciencedirect.com/science/article/pii/S0926580523004974

4. Z. Zong et al., "HouseTune: Two-Stage Floorplan Generation with LLM Assistance," arXiv preprint arXiv:2411.12279, 2024. https://arxiv.org/abs/2411.12279

5. S. Qin et al., "ChatHouseDiffusion: Prompt-Guided Generation and Editing of Floor Plans," arXiv preprint arXiv:2410.11908, 2024. https://arxiv.org/abs/2410.11908

6. R. Babakhani, M. Safarnejad, "Automated Floor Plan Generation by a Combination of Evolutionary Algorithm (Genetic) and Machine Learning," International Journal of Architectural Computing, 18(4), 2024. https://journals.sagepub.com/doi/full/10.1177/1478077120977167